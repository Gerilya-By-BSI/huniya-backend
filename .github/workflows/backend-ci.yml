# name: Backend CI/CD (Self-Hosted)

# on:
#   push:
#     branches: [main]

# jobs:
#   deploy-backend:
#     runs-on: [self-hosted, linux]

#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v3

#       - name: Setup Node.js
#         uses: actions/setup-node@v3
#         with:
#           node-version: "18"

#       - name: Install dependencies
#         run: npm install

#       - name: Build project
#         run: npm run build

#       - name: Deploy to production directory
#         run: |
#           sudo rm -rf /var/www/backend/*
#           sudo cp -r dist node_modules package.json package-lock.json prisma /var/www/backend/
#           sudo cp .env /var/www/backend/.env


#       - name: Generate Prisma client
#         run: |
#           cd /var/www/backend
#           npx prisma generate

#       - name: Restart backend app using PM2
#         run: |
#           cd /var/www/backend
#           if pm2 list | grep -q backend; then
#             echo "🔁 Restarting existing backend process..."
#             pm2 restart backend
#           else
#             echo "🚀 Starting new backend process..."
#             pm2 start dist/src/main.js --name backend
#           fi

#       - name: Deployment success
#         run: echo "✅ Backend deployed and running via PM2."
   
